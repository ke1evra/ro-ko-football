#!/bin/bash
# Скрипт для создания дампа локальной базы данных и загрузки его на сервер.

# --- НАСТРОЙКИ ---
# IP-адрес вашего удаленного сервера
SERVER_IP="185.245.35.130"
# Имя пользователя на сервере
SERVER_USER="root"
# Имя локальной базы данных
LOCAL_DB_NAME="payload"
# Название папки для дампа
DUMP_FOLDER="dump"

echo "---[ Шаг 1/2: Создание дампа локальной базы данных '$LOCAL_DB_NAME' ]---"
mongodump --db $LOCAL_DB_NAME --out ./$DUMP_FOLDER

# Проверка, что дамп создан успешно
if [ $? -ne 0 ]; then
    echo "Ошибка: не удалось создать дамп базы данных. Проверьте, запущен ли mongod."
    exit 1
fi

echo "---[ Шаг 2/2: Загрузка дампа на сервер $SERVER_IP ]---"
scp -r ./$DUMP_FOLDER ${SERVER_USER}@${SERVER_IP}:~/

# Проверка, что загрузка прошла успешно
if [ $? -ne 0 ]; then
    echo "Ошибка: не удалось загрузить дамп на сервер. Проверьте SSH-соединение и права доступа."
    exit 1
fi

# Очистка локального дампа
rm -rf ./$DUMP_FOLDER

echo "---"
echo "✅ Готово! Дамп успешно создан и загружен в домашнюю директорию на сервере."
echo "Теперь подключитесь к серверу по SSH и выполните скрипт import-and-cleanup.sh"
