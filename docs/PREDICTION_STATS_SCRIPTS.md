# üìä –°–∫—Ä–∏–ø—Ç—ã –ø–æ–¥—Å—á—ë—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
pnpm predictions:stats:calc

# –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (—Å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é)
pnpm predictions:stats:calc:force
```

---

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### 1. –ú–∞—Å—Å–æ–≤—ã–π –ø–æ–¥—Å—á—ë—Ç

```bash
# –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –±–µ–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
pnpm predictions:stats:calc

# –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é)
pnpm predictions:stats:calc:force
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- –†–µ–≥—É–ª—è—Ä–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç –Ω–æ–≤—ã—Ö –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ (cron)
- –ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∞—Ç—á–µ–π

---

### 2. –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç

```bash
# –£–¥–∞–ª–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –∑–∞–Ω–æ–≤–æ
pnpm predictions:stats:recalc
```

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** –£–¥–∞–ª—è–µ—Ç –í–°–Æ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É!

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –ø–æ–¥—Å—á—ë—Ç–∞
- –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
- –î–ª—è –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

---

### 3. –ü–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –º–∞—Ç—á—É

```bash
# –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –Ω–∞ –º–∞—Ç—á
pnpm predictions:stats:by-match 1825546

# –° –ø–µ—Ä–µ—Å—á—ë—Ç–æ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
pnpm predictions:stats:by-match 1825546 --force
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `fixtureId` - ID –º–∞—Ç—á–∞ –∏–∑ API

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ç—á–∞
- Webhook –æ—Ç API —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –º–∞—Ç—á–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –º–∞—Ç—á

---

### 4. –ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```bash
# –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
pnpm predictions:stats:by-user 67890abcdef

# –° –ø–µ—Ä–µ—Å—á—ë—Ç–æ–º
pnpm predictions:stats:by-user 67890abcdef --force
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `userId` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –ø–µ—Ä–µ—Å—á—ë—Ç
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–∞–ø–ø–µ—Ä–∞

---

### 5. –ü–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø—Ä–æ–≥–Ω–æ–∑—É

```bash
# –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞ (—Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º)
pnpm predictions:stats:by-post 6941805dbf951662b3afabaa

# –° –ø–µ—Ä–µ—Å—á—ë—Ç–æ–º
pnpm predictions:stats:by-post 6941805dbf951662b3afabaa --force
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `postId` - ID –ø–æ—Å—Ç–∞-–ø—Ä–æ–≥–Ω–æ–∑–∞ –∏–∑ –ë–î

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æÔøΩÔøΩ–∞—Ç—å:**
- –û—Ç–ª–∞–¥–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥—Å—á—ë—Ç–∞
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### Cron (Linux/Mac)

```bash
# –ö–∞–∂–¥—ã–π —á–∞—Å
0 * * * * cd /path/to/project && pnpm predictions:stats:calc

# –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
*/15 * * * * cd /path/to/project && pnpm predictions:stats:calc

# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00
0 3 * * * cd /path/to/project && pnpm predictions:stats:calc
```

### PM2

```bash
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª ecosystem.config.cjs
pm2 start ecosystem.config.cjs

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
pm2 start "pnpm predictions:stats:calc" --name "prediction-stats" --cron "0 * * * *"
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã –∏ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –º–∞—Ç—á–∏
# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∞—Å—Å–æ–≤—ã–π –ø–æ–¥—Å—á—ë—Ç
pnpm predictions:stats:calc

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∞–¥–º–∏–Ω–∫–µ –∏–ª–∏ —á–µ—Ä–µ–∑ API
curl http://localhost:3100/api/predictions/stats/USER_ID
```

### –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab
crontab -e

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–∫–∞–∂–¥—ã–π —á–∞—Å)
0 * * * * cd /Users/ko/payload-starter && pnpm predictions:stats:calc >> /tmp/prediction-stats.log 2>&1
```

### –û—Ç–ª–∞–¥–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
pnpm predictions:stats:by-post POST_ID

# –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
pnpm predictions:stats:by-user USER_ID --force

# –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å—ë –∑–∞–Ω–æ–≤–æ
pnpm predictions:stats:recalc
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "Cannot find module"

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pnpm install
```

### –û—à–∏–±–∫–∞: "Database connection failed"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cat .env | grep DATABASE_URI

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
mongosh $DATABASE_URI
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –µ—Å—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –º–∞—Ç—á–∏
# –í MongoDB:
db.matches.find({ status: 'finished' }).count()

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –µ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã
db.posts.find({ postType: 'prediction' }).count()

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å force
pnpm predictions:stats:calc:force
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–∏—Å—Ç–µ–º–µ –ø–æ–¥—Å—á—ë—Ç–∞](./PREDICTION_STATS_CALCULATION.md)
- [README —Å–∫—Ä–∏–ø—Ç–æ–≤](../scripts/prediction-stats/README.md)
- [–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏](./PREDICTION_STATS_ERRORS_FIXED.md)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`pnpm install`)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω `.env` —Ñ–∞–π–ª (DATABASE_URI, PAYLOAD_SECRET)
- [ ] –ï—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã –≤ –ë–î (`postType: 'prediction'`)
- [ ] –ï—Å—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –º–∞—Ç—á–∏ (`status: 'finished'`)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≥—Ä—É–ø–ø—ã –∏—Å—Ö–æ–¥–æ–≤ (OutcomeGroups)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –º–∞—Ä–∫–µ—Ç—ã (Markets)

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ** - –¥–æ–±–∞–≤—å—Ç–µ –≤ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥—Å—á—ë—Ç–∞
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ force –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ** - –ø–µ—Ä–µ—Å—á—ë—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –æ–¥–Ω–æ–º –ø—Ä–æ–≥–Ω–æ–∑–µ** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `by-post` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
5. **–î–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã** - –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω—ã–º –ø–µ—Ä–µ—Å—á—ë—Ç–æ–º (`recalc`)
