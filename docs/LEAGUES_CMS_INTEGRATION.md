# Интеграция управления лигами через Payload CMS

Система приоритетных лиг теперь управляется через Payload CMS вместо хардкода.

## Что изменилось

### 1. Глобал "Лиги для топ матчей"
- **Путь в админке:** `/admin/globals/topMatchesLeagues`
- **Файл:** `src/globals/TopMatchesLeagues.ts`

Позволяет настроить:
- Включение/выключение виджета
- Список лиг с приоритетами
- Настройки фильтрации

### 2. API endpoint для клиента
- **URL:** `/api/top-matches-settings`
- **Файл:** `src/app/api/top-matches-settings/route.ts`

Возвращает настройки лиг в формате, удобном для клиентских компонентов.

### 3. Обновлённая клиентская библиотека
- **Файл:** `src/lib/highlight-competitions-client.ts`

Функции теперь получают данные из API:
- `getLeaguePriorityClient()` - приоритет лиги
- `isPriorityLeagueClient()` - проверка приоритетности
- `initializeLeaguesCache()` - инициализация кэша

### 4. Обновлённый виджет
- **Файл:** `src/components/home/WeekFixturesGrouped.tsx`

Теперь инициализирует кэш лиг при загрузке и использует данные из Payload.

## Как использовать

### В админке Payload

1. Перейти в `/admin/globals/topMatchesLeagues`
2. Включить виджет (`enabled = true`)
3. Добавить лиги с приоритетами:
   - Выбрать лигу из списка
   - Установить приоритет (меньше число = выше приоритет)
   - Включить лигу (`enabled = true`)
4. Сохранить настройки

### В коде

Существующие виджеты автоматически используют новые настройки:
- `WeekFixturesGrouped` - сортирует матчи по приоритету лиг из CMS
- Другие виджеты, использующие `getLeaguePriorityClient()`

### Кэширование

- **Клиентский кэш:** 5 минут
- **Fallback:** статичные данные при недоступности API
- **Инициализация:** автоматически при загрузке виджетов

## Миграция

Старые хардкодные константы заменены на динамические данные из Payload:
- ✅ Обратная совместимость сохранена
- ✅ Fallback к статичным данным при ошибках
- ✅ Автоматическое кэширование

## Отладка

Логи в консоли браузера:
```
[LEAGUES_CLIENT] Загружено 5 лиг из Payload
[LEAGUES_CLIENT] Кэш лиг инициализирован
```

При ошибках:
```
[LEAGUES_CLIENT] Ошибка при загрузке лиг: HTTP 500
[LEAGUES_CLIENT] Используем fallback данные
```

## Производительность

- Минимальные запросы к API (кэширование 5 минут)
- Graceful degradation при ошибках
- Синхронные функции для UI компонентов
- Асинхронная инициализация кэша