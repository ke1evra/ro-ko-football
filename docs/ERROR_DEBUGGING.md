# üîç –û—Ç–ª–∞–¥–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ Digest –≤ Next.js

## –ß—Ç–æ —Ç–∞–∫–æ–µ Digest?

**Digest** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `2991916274`) ‚Äî —ç—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ö–µ—à –æ—à–∏–±–∫–∏ –≤ Next.js, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∞—Ö.

## –ö–∞–∫ –Ω–∞–π—Ç–∏ –æ—à–∏–±–∫—É –ø–æ Digest

### 1. –í –ª–æ–≥–∞—Ö Docker

```bash
# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose logs -f app

# –ò—â–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π digest
docker compose logs app | grep "2991916274"

# –ò–ª–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (—Å—Ç—Ä–æ–∫–∏ –¥–æ –∏ –ø–æ—Å–ª–µ)
docker compose logs app | grep -A 20 -B 5 "2991916274"
```

### 2. –í –ª–æ–≥–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
[LAYOUT] Digest: 2991916274
[LAYOUT] Message: Cannot read properties of undefined (reading 'require')
[LAYOUT] Stack: Error: Cannot read properties of undefined (reading 'require')
    at /app/.next/server/chunks/123.js:45:123
    at getTopMatchesLeagues (/app/src/lib/leagues.ts:9:15)
    ...
[LAYOUT] Full error: [–ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏]
```

### 3. –ü–æ–∏—Å–∫ –≤ –∫–æ–¥–µ

Digest –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ Next.js –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
- –°—Ç–µ–∫–∞ –≤—ã–∑–æ–≤–æ–≤
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–í–∞–∂–Ω–æ:** –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ digest –æ–∑–Ω–∞—á–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –æ—à–∏–±–∫—É –≤ –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –º–µ—Å—Ç–µ.

## –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **`src/lib/error-logger.ts`** ‚Äî —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
2. **`src/lib/leagues.ts`** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
3. **Layout —Ñ–∞–π–ª—ã** ‚Äî –ª–æ–≥–∏—Ä—É—é—Ç –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫ —Ç—Ä–µ–π—Å

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```typescript
import { logErrorWithDigest } from '@/lib/error-logger'

try {
  // –≤–∞—à –∫–æ–¥
} catch (error) {
  logErrorWithDigest(error as Error & { digest?: string }, 'MyFunction')
}
```

## –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### Docker Compose

```bash
# –í—Å–µ –ª–æ–≥–∏
docker compose logs app

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker compose logs --tail=100 app

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f app

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
docker compose logs app | grep -i error

# –ü–æ–∏—Å–∫ –ø–æ digest
docker compose logs app | grep "2991916274"
```

### PM2 (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

```bash
# –í—Å–µ –ª–æ–≥–∏
pm2 logs

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
pm2 logs football-platform

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
pm2 logs --err

# –ü–æ–∏—Å–∫ –ø–æ digest
pm2 logs | grep "2991916274"
```

## –¢–∏–ø–∏—á–Ω—ã–µ –º–µ—Å—Ç–∞ –æ—à–∏–±–æ–∫

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ digest `2991916274` —Å –æ—à–∏–±–∫–æ–π `Cannot read properties of undefined (reading 'require')`, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. ‚úÖ **–ò–º–ø–æ—Ä—Ç—ã Payload config** ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `import configPromise from '@payload-config'`
2. ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ getPayload** ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `await getPayload({ config: await configPromise })`
3. ‚úÖ **–í—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Payload

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –º–µ—Å—Ç

```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –º–µ—Å—Ç–∞ —Å getPayload
grep -r "getPayload" src/ --include="*.ts" --include="*.tsx"

# –ù–∞–π—Ç–∏ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã config
grep -r "import.*config.*from" src/ --include="*.ts" --include="*.tsx"
```

## –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏:

1. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ Docker –æ–±—Ä–∞–∑: `docker compose build --no-cache app`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `docker compose up -d`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs -f app`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ digest –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –∫–µ—à–∞
docker compose build --no-cache app

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker compose restart app

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f app

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps

# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
docker compose exec app sh
```
