name: appstack
services:
  caddy:
    labels:
      - "caddy=localhost"
      - "caddy.reverse_proxy={{upstreams 3000}}"
      - "caddy.encode=gzip"
      - "caddy.health_path=/"
      - "caddy.health_interval=30s"
  payload:
    labels:
      - "caddy=localhost"
      - "caddy.route.0=handle_path /api* { reverse_proxy {{upstreams 3000}} }"
      - "caddy.route.1=handle_path /admin* { reverse_proxy {{upstreams 3000}} }"
      - "caddy.health_path=/api/health"
      - "caddy.health_interval=30s"
  next:
    labels:
      - "caddy=localhost"
      - "caddy.encode=gzip"
      - "caddy.reverse_proxy={{upstreams 3000}}"
      - "caddy.health_path=/"
      - "caddy.health_interval=30s"
