# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Docker –¥–ª—è –≤–æ—Ä–∫–µ—Ä–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ `Dockerfile` –¥–ª—è –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ Next.js (–Ω–µ –Ω—É–∂–Ω–∞ –¥–ª—è –≤–æ—Ä–∫–µ—Ä–æ–≤)
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (423MB+)
- –î–æ–ª–≥–æ–µ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ (10+ –º–∏–Ω—É—Ç)

## –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π `Dockerfile.worker` –¥–ª—è –≤–æ—Ä–∫–µ—Ä–æ–≤:
- ‚úÖ –ë–µ–∑ —Å–±–æ—Ä–∫–∏ Next.js
- ‚úÖ –¢–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ (~2-3 –º–∏–Ω—É—Ç—ã)

## –§–∞–π–ª—ã

### `Dockerfile.worker`
–õ–µ–≥–∫–∏–π –æ–±—Ä–∞–∑ –¥–ª—è –≤–æ—Ä–∫–µ—Ä–æ–≤ (–∏–º–ø–æ—Ä—Ç –º–∞—Ç—á–µ–π, —Ä–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)

### `.dockerignore`
–ò—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–±–æ—Ä–∫–∏:
- `node_modules/`
- `.next/`
- `db-backups/`
- `dump/`
- `docs/`
- –∏ –¥—Ä—É–≥–∏–µ

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–æ—Ä–∫–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `Dockerfile.worker`:
```yaml
# docker-compose.prediction-stats.yml
services:
  prediction_stats_calculator:
    build:
      context: .
      dockerfile: Dockerfile.worker  # ‚Üê –õ–µ–≥–∫–∏–π –æ–±—Ä–∞–∑
```

### –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Dockerfile`:
```yaml
# docker-compose.yml
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile  # ‚Üê –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ Next.js
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Dockerfile | Dockerfile.worker |
|----------|-----------|-------------------|
| –°–±–æ—Ä–∫–∞ Next.js | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ | ~10-15 –º–∏–Ω | ~2-3 –º–∏–Ω |
| –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | 423MB+ | ~50MB |
| –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ | ~500MB | ~200MB |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | –í–æ—Ä–∫–µ—Ä—ã |

## –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –≤–æ—Ä–∫–µ—Ä–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞:

```bash
# –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
docker compose -f docker-compose.prediction-stats.yml up -d

# –í—ã–≤–æ–¥:
# [+] Building 120.5s (12/12) FINISHED
# => [internal] load build definition from Dockerfile.worker
# => [internal] load .dockerignore
# => [base 1/1] FROM docker.io/library/node:22.12.0-alpine
# => [deps 2/3] COPY package.json pnpm-lock.yaml ./
# => [deps 3/3] RUN corepack enable pnpm && pnpm i --frozen-lockfile
# => [runner 5/7] COPY --from=deps /app/node_modules ./node_modules
# => [runner 6/7] COPY --chown=worker:nodejs package.json pnpm-lock.yaml ./
# => [runner 7/7] COPY --chown=worker:nodejs scripts ./scripts
# => exporting to image
```

### –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏ –±—É–¥—É—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–º–∏:
```bash
docker compose -f docker-compose.prediction-stats.yml up -d
# [+] Running 1/1
# ‚úî Container prediction_stats_calculator  Started
```

## –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

–ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–ª–∏ –∫–æ–¥:

```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker compose -f docker-compose.prediction-stats.yml build

# –ò–ª–∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose -f docker-compose.prediction-stats.yml up -d --build
```

## –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ–±—Ä–∞–∑–æ–≤

```bash
# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã
docker image prune -a

# –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–±—Ä–∞–∑
docker rmi appstack-prediction-stats-prediction_stats_calculator
```

## Troubleshooting

### –°–±–æ—Ä–∫–∞ –∑–∞–≤–∏—Å–ª–∞ –Ω–∞ "transferring context"

**–ü—Ä–∏—á–∏–Ω–∞**: –ö–æ–ø–∏—Ä—É–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.dockerignore`:
```bash
cat .dockerignore
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏—Å–∫–ª—é—á–µ–Ω—ã:
- `node_modules/`
- `.next/`
- `db-backups/`
- `dump/`

### –û—à–∏–±–∫–∞ "no space left on device"

**–ü—Ä–∏—á–∏–Ω–∞**: –ó–∞–ø–æ–ª–Ω–µ–Ω –¥–∏—Å–∫

**–†–µ—à–µ–Ω–∏–µ**: –û—á–∏—Å—Ç–∏—Ç–µ Docker:
```bash
# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
docker system prune -a --volumes

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Å—Ç–æ
df -h
```

### –î–æ–ª–≥–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–ü—Ä–∏—á–∏–Ω–∞**: –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–ª–∏ –º–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–†–µ—à–µ–Ω–∏–µ**: 
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–µ—à Docker
2. –ò–ª–∏ —Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑ –ª–æ–∫–∞–ª—å–Ω–æ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
   ```bash
   # –õ–æ–∫–∞–ª—å–Ω–æ
   docker build -f Dockerfile.worker -t my-worker .
   docker save my-worker > worker.tar
   
   # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
   docker load < worker.tar
   ```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫**: –ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ 5-10 –º–∏–Ω—É—Ç –Ω–∞ —Å–±–æ—Ä–∫—É –æ–±—Ä–∞–∑–∞
2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–π—Ç–µ –æ–±—Ä–∞–∑
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞–∑–º–µ—Ä–æ–º –æ–±—Ä–∞–∑–æ–≤ (`docker images`)
4. **–û—á–∏—Å—Ç–∫–∞**: –†–µ–≥—É–ª—è—Ä–Ω–æ —É–¥–∞–ª—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã

## –°–º. —Ç–∞–∫–∂–µ

- `WORKERS.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–æ—Ä–∫–µ—Ä–∞–º
- `PREDICTION_STATS_DOCKER.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞—Å—á–µ—Ç—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `QUICK_START_WORKERS.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
